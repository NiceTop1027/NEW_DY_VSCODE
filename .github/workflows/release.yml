name: Build and Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [macos-latest, windows-latest, ubuntu-latest]
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build webpack
        run: npm run build
      
      - name: Build Electron app (Mac)
        if: matrix.os == 'macos-latest'
        run: npm run dist -- --mac
      
      - name: Build Electron app (Windows)
        if: matrix.os == 'windows-latest'
        run: npm run dist -- --win
      
      - name: Build Electron app (Linux)
        if: matrix.os == 'ubuntu-latest'
        run: npm run dist -- --linux
      
      - name: Upload Mac artifacts
        if: matrix.os == 'macos-latest'
        uses: actions/upload-artifact@v4
        with:
          name: mac-build
          path: |
            dist/*.dmg
            dist/*.zip
      
      - name: Upload Windows artifacts
        if: matrix.os == 'windows-latest'
        uses: actions/upload-artifact@v4
        with:
          name: windows-build
          path: |
            dist/*.exe
            dist/*.zip
      
      - name: Upload Linux artifacts
        if: matrix.os == 'ubuntu-latest'
        uses: actions/upload-artifact@v4
        with:
          name: linux-build
          path: |
            dist/*.AppImage
            dist/*.deb
            dist/*.rpm
      
      - name: Create Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v1
        with:
          files: |
            dist/*.dmg
            dist/*.exe
            dist/*.AppImage
            dist/*.zip
            dist/*.deb
            dist/*.rpm
          body: |
            # ğŸ‰ ë•ì˜ê³ ë“±í•™êµ VS Code ${{ github.ref_name }}
            
            ## âœ¨ ì£¼ìš” ê¸°ëŠ¥
            - ğŸ–¥ï¸ **ë°ìŠ¤í¬í†± ì•±** - Mac, Windows, Linux ì§€ì›
            - ğŸ’» **ì‹¤ì œ ë¡œì»¬ í„°ë¯¸ë„** - ë‚´ ì»´í“¨í„°ì˜ í„°ë¯¸ë„ ì‚¬ìš©
            - ğŸ“ **íŒŒì¼ ì‹œìŠ¤í…œ ì™„ì „ ì ‘ê·¼** - ì œí•œ ì—†ëŠ” íŒŒì¼ ê´€ë¦¬
            - ğŸ¨ **VS Code ìŠ¤íƒ€ì¼ UI** - ìµìˆ™í•œ ì¸í„°í˜ì´ìŠ¤
            - ğŸ” **ë³´ì•ˆ** - ì„¸ì…˜ ê²©ë¦¬ ë° ëª…ë ¹ì–´ í•„í„°ë§
            
            ## ğŸ“¦ ì„¤ì¹˜ ë°©ë²•
            
            ### Mac
            1. `.dmg` íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            2. íŒŒì¼ ì—´ê¸°
            3. ì•±ì„ Applications í´ë”ë¡œ ë“œë˜ê·¸
            
            ### Windows
            1. `.exe` íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            2. ì‹¤í–‰í•˜ì—¬ ì„¤ì¹˜
            
            ### Linux
            1. `.AppImage` íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            2. ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬: `chmod +x *.AppImage`
            3. ì‹¤í–‰
            
            ## ğŸŒ ì›¹ ë²„ì „
            ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì‚¬ìš©: https://vscode.dyhs.kr
            
            ## ğŸ› ë²„ê·¸ ìˆ˜ì •
            - âœ… í„°ë¯¸ë„ ê°œí–‰ ë²„ê·¸ ìˆ˜ì •
            - âœ… í„°ë¯¸ë„ ë¦¬ì‚¬ì´ì¦ˆ ìë™ ì¡°ì •
            - âœ… WebSocket ë³´ì•ˆ ì—°ê²° (WSS)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
